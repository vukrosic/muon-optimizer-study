# Muon Optimizer Tuning Guide

This guide provides a tutorial on how to get the best results with the Muon optimizer, based on the findings of a large-scale ablation study.

## Key Lessons Learned

Through a series of iterative experiments, we have learned several key lessons about tuning the Muon optimizer:

*   **Learning Rate is the Most Important Hyperparameter:** The learning rate has the most significant impact on the model's performance. It is crucial to find the optimal learning rate for your specific model and dataset.
*   **Longer Training Times Allow for Lower Learning Rates:** With a longer training schedule, the model has more time to converge, which allows for the use of a lower learning rate. This can lead to better results than using a higher learning rate with a shorter training schedule.
*   **The Optimal Hyperparameters are Interdependent:** The optimal values for learning rate, momentum, and Nesterov steps are not independent. The best combination of these hyperparameters will depend on your specific use case.
*   **Start with a Broad Search and then Refine:** A good strategy for finding the optimal hyperparameters is to start with a broad search over a wide range of values. Once you have identified a promising region, you can then perform a more fine-grained search to pinpoint the optimal values.

## How to Get the Best Results

To get the best results with the Muon optimizer, we recommend the following process:

1.  **Start with the Recommended Hyperparameters:** As a starting point, we recommend using the following hyperparameters, which were found to be optimal in our large-scale experiment:
    *   **Learning Rate:** 1/32 (0.03125)
    *   **Momentum:** 7/8 (0.875)
    *   **Nesterov Steps:** 4
2.  **Perform a Grid Search:** To find the optimal hyperparameters for your specific use case, we recommend performing a grid search over a range of values for the learning rate, momentum, and Nesterov steps. We recommend using powers of two for these values, as this has been shown to be an effective strategy.
3.  **Analyze the Results:** Once you have completed the grid search, you should analyze the results to identify the best-performing combination of hyperparameters. You can use the plots and graphs generated by the `muon_ablations.py` script to help you with this analysis.

## 1500-Step Training Run

### Performance Comparison
![Performance Comparison](images/performance_comparison.png)
This plot visually compares the key performance metrics for the 1500-step training run. The variant with a learning rate of 1/32, momentum of 7/8, and 4 Nesterov steps achieved the lowest validation loss.

### Training Curves
![Training Curves](images/training_curves.png)
The training curves for the 1500-step training run show that all variants converged to a stable validation loss. The best-performing variant is clearly identifiable by its lower validation loss curve.

### Performance Heatmap
![Performance Heatmap](images/performance_heatmap.png)
This heatmap provides a visual representation of the performance of the 1500-step training run. The darker green cells indicate better performance, and the results are consistent with the other plots.

## Detailed Results

| Rank | Optimizer Variant | Val Loss | Val Perplexity | Val Accuracy | Training Time (s) |
|---|---|---|---|---|---|
| 1 | Muon (LR 0.0312, Momentum 0.8750, 4 Steps) | 4.3998 | 81.44 | 0.3550 | 131.3 |
| 2 | Muon (LR 0.0312, Momentum 0.9375, 4 Steps) | 4.4031 | 81.70 | 0.3559 | 130.0 |
| 3 | Muon (LR 0.0312, Momentum 0.8750, 16 Steps) | 4.4144 | 82.63 | 0.3573 | 157.1 |
| 4 | Muon (LR 0.0312, Momentum 0.8750, 8 Steps) | 4.4155 | 82.73 | 0.3565 | 140.8 |
| 5 | Muon (LR 0.0312, Momentum 0.9375, 8 Steps) | 4.4430 | 85.03 | 0.3538 | 139.5 |
| 6 | Muon (LR 0.0312, Momentum 0.9375, 16 Steps) | 4.4474 | 85.40 | 0.3535 | 156.9 |
| 7 | Muon (LR 0.0625, Momentum 0.8750, 4 Steps) | 4.4972 | 89.77 | 0.3272 | 132.1 |
| 8 | Muon (LR 0.0625, Momentum 0.8750, 8 Steps) | 4.5145 | 91.33 | 0.3326 | 141.1 |
| 9 | Muon (LR 0.0625, Momentum 0.8750, 16 Steps) | 4.5161 | 91.48 | 0.3316 | 159.0 |
| 10 | Muon (LR 0.0625, Momentum 0.9375, 4 Steps) | 4.5800 | 97.52 | 0.3302 | 131.4 |
| 11 | Muon (LR 0.0625, Momentum 0.9375, 8 Steps) | 4.6878 | 108.61 | 0.3139 | 140.7 |
| 12 | Muon (LR 0.0625, Momentum 0.9375, 16 Steps) | 4.7049 | 110.49 | 0.3122 | 156.5 |
| 13 | Muon (LR 0.1250, Momentum 0.8750, 8 Steps) | 4.7849 | 119.69 | 0.2925 | 141.5 |
| 14 | Muon (LR 0.1250, Momentum 0.8750, 16 Steps) | 4.7911 | 120.44 | 0.2898 | 158.4 |
| 15 | Muon (LR 0.1250, Momentum 0.8750, 4 Steps) | 4.7959 | 121.01 | 0.2846 | 130.7 |
| 16 | Muon (LR 0.1250, Momentum 0.9375, 4 Steps) | 5.8000 | 330.29 | 0.2058 | 131.9 |
| 17 | Muon (LR 0.1250, Momentum 0.9375, 16 Steps) | 5.8934 | 362.62 | 0.2014 | 157.2 |
| 18 | Muon (LR 0.1250, Momentum 0.9375, 8 Steps) | 5.9199 | 372.39 | 0.2004 | 140.9 |